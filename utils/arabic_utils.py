# utils/arabic_utils.py - ุงููุณุฎุฉ ุงููุทูุฑุฉ ููุนุงูุฌุฉ ุงููุตูุต ูุงูุนุฑุจูุฉ ูุงูุฑููุฒ
import arabic_reshaper
from bidi.algorithm import get_display
import re

def ar(text):
    """
    ูููู ุจุชุดููู ุงููุต ุงูุนุฑุจู ูุนูุณู ููุธูุฑ ุจุดูู ุตุญูุญ ูู Kivy.
    ููุง ูููู ุจุงุณุชุจุฏุงู ุงูุฑููุฒ ุงูุชุนุจูุฑูุฉ (Emojis) ุจูุตูุต ุนุฑุจูุฉ ููุถูุญ ุฃูุซุฑ ูุชุฌูุจ ุงููุฑุจุนุงุช xxxx.
    """
    if not text:
        return ""
    
    # ุชุญููู ุงููุต ููููู ุณูุณูุฉ (string) ุฅุฐุง ูู ููู
    text = str(text)
    
    # ูุงููุณ ุงุณุชุจุฏุงู ุงูุฑููุฒ ุจูุตูุต ุนุฑุจูุฉ (ูุชุฌูุจ ูุฑุจุนุงุช xxxx ูู ุจุนุถ ุงูุฎุทูุท)
    replacements = {
        '๐': '', '๐': '', '๐': '', '๐': '', 'โจ': '', 'โ๏ธ': '',
        '๐': 'ุฅุฏุงุฑุฉ', '๐ช': 'ุฎุฑูุฌ', '๐': 'ุชุญุฏูุซ', '๐': 'ุชูุจูู',
        '๐': 'ุทูุจุงุช', '๐ฅ': 'ุทูุงุจ', '๐ข': 'ูุดุท', '๐': 'ููู',
        'โ': '+', '๐๏ธ': 'ุญุฐู', '๐': 'ููุงุฏ', '๐': 'ููู', '๐': 'ูุชุญ',
        'โฌ๏ธ': 'ุชูุฒูู', '๐จ': 'ุทูุจ', '๐พ': 'ุญูุธ', 'โ๏ธ': '!!', 'โ': 'X',
        'โ': 'V', 'โณ': 'ุงูุชุธุงุฑ', 'โจ': '*', 'โญ': '*', '๐': '', '๐': '',
        '๐': '', '๐': 'ูุชุงุจ', '๐': ''
    }
    
    for emoji, replacement in replacements.items():
        text = text.replace(emoji, replacement)
    
    # ุชูุธูู ุฃู ุฑููุฒ ุชุนุจูุฑูุฉ ูุชุจููุฉ ููุณุช ุถูู ุงููุงุฆูุฉ (ูููุน ุธููุฑ ูุฑุจุนุงุช xxxx)
    # ูุณุชุฎุฏู Regex ูุฅุจูุงุก ุงููุตูุต ุงูุนุฑุจูุฉ ูุงูุฅูุฌููุฒูุฉ ูุงูุฃุฑูุงู ูุจุนุถ ุงูุฑููุฒ ุงูุฃุณุงุณูุฉ ููุท
    text = re.sub(r'[^\u0600-\u06FF\u0750-\u077F\u08A0-\u08FFa-zA-Z0-9\s!@#$%^&*()_+\-=\[\]{};\':\"\\|,.<>\/?]+', '', text)

    # ุชุดููู ุงูุญุฑูู (ูุตู ุงูุญุฑูู ุจุจุนุถูุง)
    try:
        reshaped_text = arabic_reshaper.reshape(text)
        bidi_text = get_display(reshaped_text)
        return bidi_text
    except Exception as e:
        return text
